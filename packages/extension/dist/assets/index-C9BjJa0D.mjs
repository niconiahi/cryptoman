import{d as E,a as y,u as a,y as M,k as F,E as O}from"./preact-10.26.9-BHuVZBHX.mjs";import{v as T,m as N,H as S,g as D,k as L,w as $,p as b,a as k,b as P,s as A}from"./vendor-ddVfU9fH.mjs";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();const g={iterations:1e5,hash:"SHA-256"},c={name:"cryptoman/signer",version:1,store_name:"vault",vault_key:"credentials"};function v(e){return btoa(String.fromCharCode(...new Uint8Array(e)))}function w(e){return Uint8Array.from(atob(e),r=>r.charCodeAt(0))}async function I(e,r,n){const s=new TextEncoder().encode(e),t=await crypto.subtle.importKey("raw",s,"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:g.iterations,hash:g.hash},t,{name:"AES-GCM",length:256},!1,n)}function h(){return new Promise((e,r)=>{const n=indexedDB.open(c.name,c.version);n.onupgradeneeded=s=>{const t=s.target.result;t.objectStoreNames.contains(c.store_name)||t.createObjectStore(c.store_name)},n.onsuccess=()=>e(n.result),n.onerror=()=>r(new Error(`Failed to open database: ${n.error?.message}`))})}async function j(e,r){if(!e.trim())throw new Error("Mnemonic cannot be empty");if(!r.trim())throw new Error("Password cannot be empty");const n=crypto.getRandomValues(new Uint8Array(16)),s=crypto.getRandomValues(new Uint8Array(12)),t=await I(r,n,["encrypt"]),o=new TextEncoder().encode(e),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},t,o),u={salt:v(n),iv:v(s),cipher:v(i)},l=await h();return new Promise((p,_)=>{const f=l.transaction(c.store_name,"readwrite").objectStore(c.store_name).put(u,c.vault_key);f.onsuccess=()=>p(),f.onerror=()=>_(new Error(`Failed to save vault: ${f.error?.message}`))})}async function K(e){if(!e.trim())throw new Error("Password cannot be empty");const r=await h(),n=await new Promise((l,p)=>{const d=r.transaction(c.store_name,"readonly").objectStore(c.store_name).get(c.vault_key);d.onsuccess=()=>{const f=d.result;l(f)},d.onerror=()=>p(new Error(`Failed to load vault: ${d.error?.message}`))});if(!n)return;const s=w(n.salt),t=w(n.iv),o=w(n.cipher),i=await I(e,s,["decrypt"]),u=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},i,o).catch(l=>{throw l instanceof Error?new Error("Invalid password or corrupted vault"):new Error("invalid unkwown error")});return new TextDecoder().decode(u)}async function q(){const e=await h();return new Promise(r=>{const t=e.transaction(c.store_name,"readonly").objectStore(c.store_name).get(c.vault_key);t.onsuccess=()=>r(!!t.result),t.onerror=()=>r(!1)})}async function B(e){try{return await K(e)!==void 0}catch{return!1}}const G="Invariant failed";function U(e,r){if(e)return;const s=`${G}: ${r}`;throw new Error(s)}function H(e){if(!T(e,$))throw new Error("Invalid mnemonic");return N(e)}function V(e){return S.fromMasterSeed(e)}function R(e,r="m/44'/60'/0'/0/0"){const n=e.derive(r);if(!n.privateKey)throw new Error("No private key available");return n.privateKey}function W(e){const r=D(e,!1),n=L(r.slice(1));return`0x${z(n.slice(-20))}`}function z(e){return Array.from(e).map(r=>r.toString(16).padStart(2,"0")).join("")}const x=E({key:new S({privateKey:new Uint8Array(32).fill(1)}),address:""}),J="password",m=E(J);function Q(){const[e,r]=y("");return a("div",{children:[a("input",{placeholder:"Password",value:e,onInput:n=>{const s=n.currentTarget.value;r(s)}}),a("button",{type:"button",onClick:async()=>{if(!await B(e))return;const s=await K(e);U(s,"vault should exist to sign in");const t=H(s),o=V(t),i=R(o),u=W(i);x.value={address:u,key:o},m.value="wallet"},children:"unlock"})]})}function X(){return a("div",{children:a("span",{children:["the connected address is ",x.value.address]})})}const Y=k(A(),P(8)),Z=k(A(),P(1));function ee(){const[e,r]=y(""),[n,s]=y("smile price bomb movie minimum treat hurdle adult wing come space cross");return a("main",{children:[a("input",{placeholder:"Mnemonics",value:n,onInput:t=>{const o=t.currentTarget.value;s(o)}}),a("input",{placeholder:"Password",value:e,onInput:t=>{const o=t.currentTarget.value;r(o)}}),a("button",{type:"button",onClick:()=>{const t=b(Z,n),o=b(Y,e);j(t,o),m.value="password"},children:"save wallet"})]})}function te(){return M(()=>{async function e(){await q()||(m.value="mnemonics")}e()},[]),a(F,{children:re(m.value)})}function re(e){switch(e){case"mnemonics":return a(ee,{});case"password":return a(Q,{});case"wallet":return a(X,{});default:return a("div",{children:["there is no view for: ",e]})}}O(a(te,{}),document.querySelector("#app"));
