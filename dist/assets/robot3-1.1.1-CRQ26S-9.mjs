function i(e){return{enumerable:!0,value:e}}function x(e){return{enumerable:!0,writable:!0,value:e}}let m={},N=()=>!0,S=e=>e,$=(e,t,r,u)=>e.apply(r,u)&&t.apply(r,u),B=(e,t,r,[u,n])=>t.call(r,e.call(r,u,n),n),y=(e,t)=>Object.freeze(Object.create(e,t));function T(e,t,r){return e.reduce((u,n)=>function(...l){return r(u,n,this,l)},t)}function j(e){return y(this,{fn:i(e)})}let _={};j.bind(_);let C={};j.bind(C);function w(e,t){return t.filter(r=>e.isPrototypeOf(r))}function k(e,t,...r){let u=T(w(C,r).map(l=>l.fn),N,$),n=T(w(_,r).map(l=>l.fn),S,B);return y(this,{from:i(e),to:i(t),guards:i(u),reducers:i(n)})}let F={},I={};k.bind(F);k.bind(I,null);function P(e,t,r,u){let{context:n}=e;for(let{to:l,guards:h,reducers:c}of u)if(h(n,r)){e.context=c.call(e,n,r);let o=t.original||t,a=y(o,{current:i(l),original:{value:o}});m._onEnter&&m._onEnter(t,l,e.context,n,r);let s=a.state.value;e.machine=a;let b=s.enter(a,e,r);return e.onChange(e),b}}function U(e,t){let r=t.type||t,{machine:u}=e,{value:n,name:l}=u.state;return n.transitions.has(r)?P(e,u,t,n.transitions.get(r))||u:(m._send&&m._send(r,l),u)}let W={send(e){U(this,e)}};function q(e,t,r,u){let n=Object.create(W,{machine:x(e),context:x(e.context(r,u)),onChange:i(t)});return n.send=n.send.bind(n),n.machine=n.machine.state.value.enter(n.machine,n,u),n}const{create:A,freeze:D}=Object;function O(e){return{enumerable:!0,value:e}}function p(e){return D(A(e.machine.state,{context:O(e.context||{}),service:O(e)}))}function H(e,t){return function(u,n){let[l,h]=t(u),[c,o]=t(s),a=!0;function s(f,z){return q(f||l,E=>{if(!a)return;let d=E;for(;d.child;)d=d.child;g(p(d))},z||n)}let[b,g]=t(p(c));return e(()=>{if(a=!0,l!==u){h(u);let f=s(u,n);o(f),g(p(f))}return()=>{a=!1}},[u]),[b,c.send,c]}}export{H as c};
