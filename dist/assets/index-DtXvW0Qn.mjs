import{u as s,d as w,E as P}from"./preact-10.26.9-Cg_eOskk.mjs";import{u as S}from"./preact-robot-1.1.0-Bf3yx1pk.mjs";import{a as C,s as b,t as v}from"./robot3-1.1.1-B9XTajXJ.mjs";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();function g({state:t,send:r}){const n=t.name;return s("div",{children:[s("span",{children:["the current state is ",n]}),s("button",{type:"button",onClick:()=>{r("unlock")},children:"unlock"})]})}const k={iterations:1e5,hash:"SHA-256"},c={name:"walle",version:1,storeName:"vault",vaultKey:"vault"};function m(t){return btoa(String.fromCharCode(...new Uint8Array(t)))}function h(t){return Uint8Array.from(atob(t),r=>r.charCodeAt(0))}async function E(t,r,n){const a=new TextEncoder().encode(t),e=await crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:k.iterations,hash:k.hash},e,{name:"AES-GCM",length:256},!1,n)}function _(){return new Promise((t,r)=>{const n=indexedDB.open(c.name,c.version);n.onupgradeneeded=a=>{const e=a.target.result;e.objectStoreNames.contains(c.storeName)||e.createObjectStore(c.storeName)},n.onsuccess=()=>t(n.result),n.onerror=()=>r(new Error(`Failed to open database: ${n.error?.message}`))})}async function A(t,r){if(!t.trim())throw new Error("Mnemonic cannot be empty");if(!r.trim())throw new Error("Password cannot be empty");const n=crypto.getRandomValues(new Uint8Array(16)),a=crypto.getRandomValues(new Uint8Array(12)),e=await E(r,n,["encrypt"]),o=new TextEncoder().encode(t),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},e,o),p={salt:m(n),iv:m(a),cipher:m(i)},l=await _();return new Promise((u,y)=>{const d=l.transaction(c.storeName,"readwrite").objectStore(c.storeName).put(p,c.vaultKey);d.onsuccess=()=>u(),d.onerror=()=>y(new Error(`Failed to save vault: ${d.error?.message}`))})}async function K(t){if(!t.trim())throw new Error("Password cannot be empty");const r=await _(),n=await new Promise((l,u)=>{const f=r.transaction(c.storeName,"readonly").objectStore(c.storeName).get(c.vaultKey);f.onsuccess=()=>{const d=f.result;d?l(d):u(new Error("No vault found"))},f.onerror=()=>u(new Error(`Failed to load vault: ${f.error?.message}`))}),a=h(n.salt),e=h(n.iv),o=h(n.cipher),i=await E(t,a,["decrypt"]),p=await crypto.subtle.decrypt({name:"AES-GCM",iv:e},i,o).catch(l=>{throw l instanceof Error?new Error("Invalid password or corrupted vault"):new Error("invalid unkwown error")});return new TextDecoder().decode(p)}function F({state:t,send:r}){const[n,a]=w(""),[e,o]=w("test123"),i=t.name;return s("div",{children:[s("span",{children:["the current state is ",i]}),s("div",{style:{margin:"20px 0",border:"1px solid #ccc",padding:"10px"},children:[s("h3",{children:"Vault Test"}),s("input",{type:"password",value:e,onInput:u=>o(u.target.value),placeholder:"Password"}),s("br",{}),s("button",{type:"button",onClick:async()=>{await A("hello world",e)},children:'Store "hello world"'}),s("button",{type:"button",onClick:async()=>{const u=await K(e);a(u)},children:"Retrieve"}),n&&s("p",{children:n})]}),s("button",{type:"button",onClick:()=>{r("lock")},children:"lock"})]})}function O(){return{user:"Andy"}}const x=C({locked:b(v("unlock","unlocked")),unlocked:b(v("lock","locked"))},O);function M(){const[t,r]=S(x);switch(t.name){case"locked":return s(g,{state:t,send:r});case"unlocked":return s(F,{state:t,send:r});default:return s(g,{state:t,send:r})}}P(s(M,{}),document.querySelector("#app"));
