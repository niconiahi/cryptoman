function a(e){return{enumerable:!0,value:e}}function x(e){return{enumerable:!0,writable:!0,value:e}}let c={},B=()=>!0,w=()=>({}),j=e=>e,P=(e,t,n,r)=>e.apply(n,r)&&t.apply(n,r),U=(e,t,n,[r,i])=>t.call(n,e.call(n,r,i),i),s=(e,t)=>Object.freeze(Object.create(e,t));function O(e,t,n){return e.reduce((r,i)=>function(...u){return n(r,i,this,u)},t)}function k(e){return s(this,{fn:a(e)})}let C={};k.bind(C);let M={};k.bind(M);function p(e,t){return t.filter(n=>e.isPrototypeOf(n))}function z(e,t,...n){let r=O(p(M,n).map(u=>u.fn),B,P),i=O(p(C,n).map(u=>u.fn),j,U);return s(this,{from:a(e),to:a(t),guards:a(r),reducers:a(i)})}let E={},I={},Q=z.bind(E);z.bind(I,null);function W(e,t,n){return N(t,e,n,this.immediates)||e}function q(e){let t=new Map;for(let n of e)t.has(n.from)||t.set(n.from,[]),t.get(n.from).push(n);return t}let A={enter:j};function R(...e){let t=p(E,e),n=p(I,e),r={final:a(e.length===0),transitions:a(q(t))};return n.length&&(r.immediates=a(n),r.enter=a(W)),s(A,r)}let D={get state(){return{name:this.current,value:this.states[this.current]}}};function V(e,t,n=w){return typeof e!="string"&&(n=t||w,t=e,e=Object.keys(t)[0]),c._create&&c._create(e,t),s(D,{context:a(n),current:a(e),states:a(t)})}function N(e,t,n,r){let{context:i}=e;for(let{to:u,guards:b,reducers:o}of r)if(b(i,n)){e.context=o.call(e,i,n);let f=t.original||t,l=s(f,{current:a(u),original:{value:f}});c._onEnter&&c._onEnter(t,u,e.context,i,n);let m=l.state.value;e.machine=l;let y=m.enter(l,e,n);return e.onChange(e),y}}function F(e,t){let n=t.type||t,{machine:r}=e,{value:i,name:u}=r.state;return i.transitions.has(n)?N(e,r,t,i.transitions.get(n))||r:(c._send&&c._send(n,u),r)}let G={send(e){F(this,e)}};function H(e,t,n,r){let i=Object.create(G,{machine:x(e),context:x(e.context(n,r)),onChange:a(t)});return i.send=i.send.bind(i),i.machine=i.machine.state.value.enter(i.machine,i,r),i}const{create:J,freeze:K}=Object;function _(e){return{enumerable:!0,value:e}}function g(e){return K(J(e.machine.state,{context:_(e.context||{}),service:_(e)}))}function X(e,t){return function(r,i){let[u,b]=t(r),[o,f]=t(m),l=!0;function m(h,S){return H(h||u,$=>{if(!l)return;let d=$;for(;d.child;)d=d.child;T(g(d))},S||i)}let[y,T]=t(g(o));return e(()=>{if(l=!0,u!==r){b(r);let h=m(r,i);f(h),T(g(h))}return()=>{l=!1}},[r]),[y,o.send,o]}}export{V as a,X as c,R as s,Q as t};
